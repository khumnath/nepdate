<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bikram Calendar</title>
    <link href="https://fonts.googleapis.com/css2?family=Laila:wght@400;500&display=swap" rel="stylesheet">
    <script type="text/javascript" src="bikram.js"></script>
    <script type="text/javascript" src="tithi.js"></script>
    <style>
        body {
            font-family: 'Laila', serif;
            margin: 20px;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 825px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #007bff;
        }

        .navigation {
            margin: 20px 0;
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .navigation select,
        .navigation input,
        .navigation button {
            padding: 10px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f1f1f1;
            flex: 1 1 auto;
        }

        .navigation button {
            background-color: #007bff;
            color: white;
            border: none;
        }

        .navigation button:hover {
            background-color: #0056b3;
        }

        h2 {
            text-align: center;
            margin: 20px 0;
            font-size: 24px;
            color: #333;
        }

        table {
            width: 100%;
            margin-top: 20px;
            table-layout: fixed;
            border-radius: 15px;
            border-collapse: separate;
            border-spacing: initial;
}

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            position: relative; 
            cursor: pointer;
        }

        th {
            background-color: #007bff;
            color: white;
        }

        td {
            height: 60px;
            vertical-align: top;
            position: relative; 
        }
     
        tr:first-child td:first-child {
            border-top-left-radius: 8px;
        }

        tr:first-child td:last-child {
            border-top-right-radius: 8px;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        .today {
            background-color: rgb(73, 171, 73);
            color: white;
            border-radius: 10px;
        }

        .saturday {
            color: #e31227;
        }

        .today.saturday {
             color: white !important;
}

        .empty {
            background-color: #f1f1f1;
        }

        @media (max-width: 768px) {
            body {
                margin: 10px;
            }

            h2 {
                font-size: 20px;
            }

            .navigation select,
            .navigation input,
            .navigation button {
                font-size: 14px;
                padding: 8px;
            }

            th, td {
                padding: 5px;
                font-size: 14px;
                font-weight: bold;
            }

            td {
                height: 60px;
            }
        }

        @media (max-width: 480px) {
            h2 {
                font-size: 18px;
            }

            .navigation select,
            .navigation input,
            .navigation button {
                font-size: 12px;
                padding: 6px;
            }

            th, td {
                padding: 3px;
                font-size: 12px;
                font-weight: bold;
            }

            td {
                height: 50px;
            }
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #f1f1f1;
            margin-top: 20px;
            font-size: 14px;
            color: #333;
            border-top: 1px solid #ddd;
        }

        footer a {
            color: #007bff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            footer {
                font-size: 12px;
                padding: 15px;
            }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .tithi {
            color: #106bdb; 
            font-size: xx-small; 
            font-weight: lighter !important;
        }

        .today .tithi {
            color: white !important; 
            font-weight: bold !important;
}

        .gregorian {
            color: rgb(231 175 68);
            font-size: 65%;
            position: absolute; 
            bottom: 2px; 
            left: 2px; 
            margin: 2px;
        }

        .gregorian-month-display {
            font-size: x-small;
            color: #827a7a;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            justify-content: flex-end;
}
.ConverterLink {
            display: block;
            padding: 10px 20px;
            font-weight: bold;
            color: white;
            background-color: #007bff;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
}

    </style>
</head>
<body>
    <div class="container">
        <h1>विक्रम सम्बत क्यालेण्डर</h1>
        <div class="navigation">
            <button onclick="previousYear()">Previous Year</button>
            <select id="monthSelector" onchange="changeMonth()">
                <option value="1">बैसाख</option>
                <option value="2">जेष्ठ</option>
                <option value="3">आषाढ</option>
                <option value="4">श्रावण</option>
                <option value="5">भाद्र</option>
                <option value="6">आश्विन</option>
                <option value="7">कार्तिक</option>
                <option value="8">मंसिर</option>
                <option value="9">पौष</option>
                <option value="10">माघ</option>
                <option value="11">फागुन</option>
                <option value="12">चैत</option>
            </select>
            <input type="number" id="yearInput" value="" onchange="changeYear()" />
            <button onclick="nextYear()">Next Year</button>
            <button class="today-button" onclick="goToToday()">Today</button>
        </div>
        <div id="calendar"></div><br>
        <a href="index.html" class="ConverterLink">&#128073; Calendar Example</a>
    </div>
    <div id="tithiModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <p id="tithiInfo"></p>
        </div>
    </div>
    <footer>
        <p>© 2024 <a href="https://khumnath.com.np/">khumnath</a>. This project is licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">GNU General Public License v3.0 or later</a>.</p>
        <p>For more details, see the <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">GPL v3 license</a>.</p>
    </footer>    
    <script>
        let currentYear;
        let currentMonth;
        let currentDay;

        function showCurrentMonth() {
            const today = new Date();
            const bikram = new Bikram();
            bikram.fromGregorian(today.getFullYear(), today.getMonth() + 1, today.getDate());
            
            currentYear = bikram.getYear();
            currentMonth = bikram.getMonth();
            currentDay = bikram.getDay();

            document.getElementById('yearInput').value = currentYear;
            document.getElementById('monthSelector').value = currentMonth;

            generateCalendar(currentYear, currentMonth);
        }

        function getfirstWeekday(year, month) {
            const bikram = new Bikram();
            const firstGregorianDate = bikram.toGregorian(year, month, 1);
            const timeinfo = new Date(firstGregorianDate.year, firstGregorianDate.month - 1, firstGregorianDate.day);
            const weekdayIndex = timeinfo.getDay();
            return weekdayIndex;
        }

        function convertToDevanagari(number) {
    const devanagariDigits = ['०', '१', '२', '३', '४', '५', '६', '७', '८', '९'];
    return number.toString().split('').map(digit => devanagariDigits[parseInt(digit, 10)]).join('');
}

function generateCalendar(year, month) {
    const calendarDiv = document.getElementById('calendar');
    calendarDiv.innerHTML = '';

    const daysInMonth = new Bikram().daysInMonth(year, month);
    const bikram = new Bikram();
    
    const today = new Date();
    const todayBikram = new Bikram();
    todayBikram.fromGregorian(today.getFullYear(), today.getMonth() + 1, today.getDate());
    const todayBikramYear = todayBikram.getYear();
    const todayBikramMonth = todayBikram.getMonth();
    const todayBikramDay = todayBikram.getDay();

    const defaultLanguage = "nepali";
    const monthName = getMonthNameWithDefaultLanguage(month, defaultLanguage);
    const gregorianStart = getGregorianDate(year, month, 1);
    const gregorianEnd = getLastDayOfGregorian(year, month);

    const gregorianMonthDisplay = formatGregorianMonthDisplay(gregorianStart, gregorianEnd);

    
    let calendarHTML = `<h2>${monthName} ${convertToDevanagari(year)} <span class="gregorian-month-display">${gregorianMonthDisplay}</span></h2><table><tr>`;
    
    const weekdays = ['आइतवार', 'सोमवार', 'मङ्गलवार', 'बुधवार', 'बिहीवार', 'शुक्रवार', 'शनिवार'];  // Nepali weekdays
    
    weekdays.forEach(day => {
        calendarHTML += `<th>${day}</th>`;
    });
    calendarHTML += '</tr><tr>';

    const firstDayOfMonth = getfirstWeekday(year, month);

    for (let i = 0; i < firstDayOfMonth; i++) {
        calendarHTML += '<td class="empty"></td>';
    }

    for (let day = 1; day <= daysInMonth; day++) {
        const isToday = (day === todayBikramDay && month === todayBikramMonth && year === todayBikramYear);
        const className = isToday ? 'today' : '';
        
        // Highlight Saturdays (index 6)
        const saturdayClass = (firstDayOfMonth + day - 1) % 7 === 6 ? 'saturday' : '';
        const finalClass = className ? ` ${className}` : '';
        
        // Calculate Tithi
        const gregorianDate = bikram.toGregorian(year, month, day);
        const tithi = calculateTithi(gregorianDate.year, gregorianDate.month, gregorianDate.day);
        
        let tithiImage = '';
        if (tithi.tithi === 'पूर्णिमा') {
            tithiImage = '<img src="purnima.png" alt="Purnima" style="width:20px;height:20px;">';
        } else if (tithi.tithi === 'अमावास्या') {
            tithiImage = '<img src="amawasya.png" alt="Amawasya" style="width:20px;height:20px;">';
        }

        calendarHTML += `<td class="${finalClass} ${saturdayClass}" onclick="showTithiInfo(${gregorianDate.year}, ${gregorianDate.month}, ${gregorianDate.day}, ${day}, '${tithi.tithi}', '${tithi.paksha}')">
                            <div class="day-content">
                                <div>${convertToDevanagari(day)}</div>
                                <div class="tithi">${tithi.tithi} ${tithiImage}</div>
                                <div class="gregorian">${gregorianDate.day}</div>
                            </div>
                         </td>`;
        
        if ((firstDayOfMonth + day) % 7 === 0 && day !== daysInMonth) {
            calendarHTML += '</tr><tr>';
        }
    }

    const remainingCells = (firstDayOfMonth + daysInMonth) % 7;
    if (remainingCells !== 0) {
        for (let i = 0; i < 7 - remainingCells; i++) {
            calendarHTML += '<td class="empty"></td>';
        }
    }

    calendarHTML += '</tr></table>';
    calendarDiv.innerHTML = calendarHTML;
}


function showTithiInfo(year, month, day, bikramDay, tithi, paksha) {
    const tithiInfo = `तिथि: ${tithi}<br>पक्ष: ${paksha}<br>इस्वि सम्बत् तारीख: ${convertToDevanagari(year)}-${convertToDevanagari(month)}-${convertToDevanagari(day)}<br>विक्रम दिन: ${convertToDevanagari(bikramDay)}`;
    document.getElementById('tithiInfo').innerHTML = tithiInfo;
    document.getElementById('tithiModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('tithiModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('tithiModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}


function showTithiInfo(year, month, day, bikramDay, tithi, paksha) {
    const tithiInfo = `तिथि: ${tithi}<br>पक्ष: ${paksha}<br>तारीख: ${year}-${month}-${day}<br>विक्रम दिन: ${bikramDay}`;
    document.getElementById('tithiInfo').innerHTML = tithiInfo;
    document.getElementById('tithiModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('tithiModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('tithiModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}


function showTithiInfo(year, month, day, bikramDay, tithi, paksha) {
    const tithiInfo = `तिथि: ${tithi}<br>पक्ष: ${paksha}<br>तारीख: ${year}-${month}-${day}<br>विक्रम दिन: ${bikramDay}`;
    document.getElementById('tithiInfo').innerHTML = tithiInfo;
    document.getElementById('tithiModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('tithiModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('tithiModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}


function showTithiInfo(year, month, day, bikramDay, tithi, paksha) {
    const tithiInfo = `तिथि: ${tithi}<br>पक्ष: ${paksha}<br>मिति: ${year}-${month}-${day}<br>विक्रम दिन: ${bikramDay}`;
    document.getElementById('tithiInfo').innerHTML = tithiInfo;
    document.getElementById('tithiModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('tithiModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('tithiModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}


function showTithiInfo(year, month, day) {
    const tithi = calculateTithi(year, month, day);
    const tithiInfo = `तिथि: ${tithi.tithi}<br>पक्ष: ${tithi.paksha}<br>तारीख: ${year}-${month}-${day}`;
    document.getElementById('tithiInfo').innerHTML = tithiInfo;
    document.getElementById('tithiModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('tithiModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('tithiModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}


        function getMonthNameWithDefaultLanguage(month, language) {
            const bikram = new Bikram();
            const originalGetMonthName = bikram.getMonthName.bind(bikram);
            bikram.getMonthName = function(month) {
                const nepaliMonths = ["बैसाख", "जेष्ठ", "आषाढ", "श्रावण", "भाद्र", "आश्विन", "कार्तिक", "मंसिर", "पौष", "माघ", "फागुन", "चैत"];
                return nepaliMonths[month - 1];
            }

            const monthName = bikram.getMonthName(month);

            return monthName;
        }

        function previousYear() {
            currentYear--;
            document.getElementById('yearInput').value = currentYear;
            generateCalendar(currentYear, currentMonth);
        }

        function nextYear() {
            currentYear++;
            document.getElementById('yearInput').value = currentYear;
            generateCalendar(currentYear, currentMonth);
        }

        function changeMonth() {
            currentMonth = parseInt(document.getElementById('monthSelector').value);
            generateCalendar(currentYear, currentMonth);
        }

        function changeYear() {
            currentYear = parseInt(document.getElementById('yearInput').value);
            generateCalendar(currentYear, currentMonth);
        }

        function goToToday() {
            const today = new Date();
            const bikram = new Bikram();
            bikram.fromGregorian(today.getFullYear(), today.getMonth() + 1, today.getDate());
            currentYear = bikram.getYear();
            currentMonth = bikram.getMonth();
            document.getElementById('yearInput').value = currentYear;
            document.getElementById('monthSelector').value = currentMonth;
            generateCalendar(currentYear, currentMonth);
        }

        function getGregorianDate(year, month, day) {
    const bikram = new Bikram();
    return bikram.toGregorian(year, month, day);
}

function getLastDayOfGregorian(year, month) {
    const bikram = new Bikram();
    const nextMonthFirstDay = bikram.toGregorian(year, month + 1, 1);
    const lastDayOfMonth = new Date(nextMonthFirstDay.year, nextMonthFirstDay.month - 1, nextMonthFirstDay.day - 1);
    return {
        day: lastDayOfMonth.getDate(),
        month: lastDayOfMonth.getMonth() + 1, // months are 0-indexed in JavaScript Date
        year: lastDayOfMonth.getFullYear()
    };
}

function getGregorianMonthName(month) {
    const gregorianMonths = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    return gregorianMonths[month - 1];
}

function formatGregorianMonthDisplay(gregorianStart, gregorianEnd) {
    if (gregorianStart.year === gregorianEnd.year) {
        if (gregorianStart.month === gregorianEnd.month) {
            return `${gregorianStart.year} ${getGregorianMonthName(gregorianStart.month)}`;
        } else {
            return `${gregorianStart.year} ${getGregorianMonthName(gregorianStart.month)}/${getGregorianMonthName(gregorianEnd.month)}`;
        }
    } else {
        return `${gregorianStart.year}/${gregorianEnd.year} ${getGregorianMonthName(gregorianStart.month)}/${getGregorianMonthName(gregorianEnd.month)}`;
    }
}


        window.onload = showCurrentMonth;
    </script>
</body>
</html>
